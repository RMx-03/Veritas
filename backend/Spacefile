# Deta Space configuration
v: 0
micros:
  - name: veritas-api
    src: .
    engine: python3.9
    primary: true
    run: uvicorn main:app
    dev: uvicorn main:app --reload
    presets:
      env:
        - name: OPENROUTER_API_KEY
          description: "OpenRouter API key for AI analysis"
          default: ""
        - name: OPENROUTER_BASE_URL
          description: "OpenRouter base URL"
          default: "https://openrouter.ai/api/v1"
        - name: OPENROUTER_MODEL
          description: "OpenRouter model id (e.g., deepseek/deepseek-r1)"
          default: "deepseek/deepseek-r1"
        - name: OPENROUTER_SITE_URL
          description: "Site URL sent as HTTP-Referer header to OpenRouter"
          default: ""
        - name: OPENROUTER_APP_NAME
          description: "App name sent as X-Title header to OpenRouter"
          default: "Veritas API"
        - name: HUGGINGFACE_API_KEY  
          description: "HuggingFace API key for OCR (TrOCR/Donut)"
          default: ""
        - name: OCR_ENGINE
          description: "OCR engine to use: advanced, easyocr, paddle, or tesseract"
          default: "advanced"
        - name: OCR_ENGINE_ADVANCED
          description: "Advanced OCR pipeline mode: hybrid, easyocr, paddle"
          default: "hybrid"
        - name: HF_TROCR_MODEL
          description: "Hugging Face TrOCR model id"
          default: "microsoft/trocr-large-printed"
        - name: HF_DONUT_MODEL
          description: "Hugging Face Donut model id"
          default: "naver-clova-ix/donut-base-finetuned-docvqa"
        - name: USE_LAYOUT_REFINER
          description: "Use optional LayoutLM DocVQA refinement (true/false)"
          default: "false"
        - name: HF_DOCVQA_MODEL
          description: "HF DocVQA/LayoutLM model id"
          default: "impira/layoutlm-document-qa"
        - name: SUPABASE_URL
          description: "Supabase project URL"
          default: ""
        - name: SUPABASE_ANON_KEY
          description: "Supabase anonymous key"
          default: ""
        - name: USDA_API_KEY
          description: "USDA API key (optional)"
          default: ""
        - name: OPENFOODFACTS_BASE_URL
          description: "OpenFoodFacts product API base URL"
          default: "https://world.openfoodfacts.org/api/v0/product/"
        - name: DOCTR_API_MODEL
          description: "DocTR model id for HF Inference API OCR"
          default: "microsoft/trocr-small-printed"
        - name: ALLOWED_ORIGINS
          description: "Comma-separated allowed origins for CORS (use '*' only in development)"
          default: "*"
        - name: MAX_UPLOAD_MB
          description: "Max upload size in MB for /analyze"
          default: "10"
        - name: RATE_LIMIT_PER_MINUTE
          description: "Per-IP requests per minute limit"
          default: "120"
        - name: WARMUP_ON_STARTUP
          description: "Warm up OCR engines on startup (true/false)"
          default: "true"
        - name: WARMUP_ENGINES
          description: "Comma-separated engines to warm (easyocr,paddle)"
          default: "easyocr"
